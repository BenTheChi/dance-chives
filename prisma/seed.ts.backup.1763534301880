import { PrismaClient } from "@prisma/client";
import { insertEvent } from "../src/db/queries/event";
import { insertWorkshop } from "../src/db/queries/workshop";
import { insertSession } from "../src/db/queries/session";
import { signupUser } from "../src/db/queries/user";
import { Event } from "../src/types/event";
import { Workshop } from "../src/types/workshop";
import { Session } from "../src/types/session";
import { City } from "../src/types/city";
import driver from "../src/db/driver";
import {
  setVideoRoles,
  setSectionWinner,
  setEventRoles,
  addTeamMember,
  addWorkshopTeamMember,
  addSessionTeamMember,
} from "../src/db/queries/team-member";

const prisma = new PrismaClient();

async function main() {
  console.log("ðŸŒ± Seeding PostgreSQL database...");

  // Clear Neo4j data FIRST before creating anything
  console.log("ðŸ§¹ Clearing existing Neo4j data...");
  const clearSession = driver.session();
  try {
    await clearSession.run("MATCH (n) DETACH DELETE n");
    console.log("âœ… Neo4j database cleared");
  } catch (error) {
    console.error("âš ï¸  Error clearing Neo4j database:", error);
  } finally {
    await clearSession.close();
  }

  // Clear all existing data
  console.log("ðŸ—‘ï¸  Clearing existing PostgreSQL data...");

  const safeDelete = async (
    operation: () => Promise<any>,
    tableName: string
  ) => {
    try {
      await operation();
    } catch (error: any) {
      if (error.code === "P2021" || error.message?.includes("does not exist")) {
        console.log(`âš ï¸  Table ${tableName} does not exist, skipping...`);
      } else {
        throw error;
      }
    }
  };

  await safeDelete(
    () => prisma.requestApproval.deleteMany(),
    "RequestApproval"
  );
  await safeDelete(() => prisma.notification.deleteMany(), "Notification");
  await safeDelete(
    () => prisma.authLevelChangeRequest.deleteMany(),
    "AuthLevelChangeRequest"
  );
  await safeDelete(
    () => prisma.teamMemberRequest.deleteMany(),
    "TeamMemberRequest"
  );
  await safeDelete(() => prisma.taggingRequest.deleteMany(), "TaggingRequest");
  await prisma.event.deleteMany();
  await prisma.account.deleteMany();
  await prisma.user.deleteMany();
  console.log("âœ… Cleared all existing data");

  // Create Users
  console.log(`ðŸŒ± Creating ${0} users...`);
  const users = null;

  for (const userData of users) {
    await prisma.user.create({
      data: userData,
    });
    console.log(`âœ… Created user: ${userData.email}`);
  }

  // Create Accounts
  console.log(`ðŸŒ± Creating ${0} accounts...`);
  const accounts = null;

  for (const accountData of accounts) {
    await prisma.account.create({
      data: accountData,
    });
    console.log(`âœ… Created account for user: ${accountData.userId}`);
  }

  // Create Event references
  console.log(`ðŸŒ± Creating ${0} event references...`);
  const eventReferences = null;

  for (const eventRef of eventReferences) {
    await prisma.event.create({
      data: eventRef,
    });
    console.log(`âœ… Created event reference: ${eventRef.eventId}`);
  }

  // Create TaggingRequests
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} tagging requests...`);
    const taggingRequests = null;

    for (const request of taggingRequests) {
      await prisma.taggingRequest.create({
        data: request,
      });
    }
    console.log(`âœ… Created ${0} tagging requests`);
  }

  // Create TeamMemberRequests
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} team member requests...`);
    const teamMemberRequests = null;

    for (const request of teamMemberRequests) {
      await prisma.teamMemberRequest.create({
        data: request,
      });
    }
    console.log(`âœ… Created ${0} team member requests`);
  }

  // Create AuthLevelChangeRequests
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} auth level change requests...`);
    const authLevelChangeRequests = null;

    for (const request of authLevelChangeRequests) {
      await prisma.authLevelChangeRequest.create({
        data: request,
      });
    }
    console.log(`âœ… Created ${0} auth level change requests`);
  }

  // Create RequestApprovals
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} request approvals...`);
    const requestApprovals = null;

    for (const approval of requestApprovals) {
      await prisma.requestApproval.create({
        data: approval,
      });
    }
    console.log(`âœ… Created ${0} request approvals`);
  }

  // Create Notifications
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} notifications...`);
    const notifications = null;

    for (const notification of notifications) {
      await prisma.notification.create({
        data: notification,
      });
    }
    console.log(`âœ… Created ${0} notifications`);
  }

  // Create Sessions (NextAuth)
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} sessions...`);
    const sessions = null;

    for (const sessionData of sessions) {
      await prisma.session.create({
        data: sessionData,
      });
    }
    console.log(`âœ… Created ${0} sessions`);
  }

  // Create VerificationTokens
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} verification tokens...`);
    const verificationTokens = null;

    for (const token of verificationTokens) {
      await prisma.verificationToken.create({
        data: token,
      });
    }
    console.log(`âœ… Created ${0} verification tokens`);
  }

  // Create Authenticators
  if (0 > 0) {
    console.log(`ðŸŒ± Creating ${0} authenticators...`);
    const authenticators = null;

    for (const authenticator of authenticators) {
      await prisma.authenticator.create({
        data: authenticator,
      });
    }
    console.log(`âœ… Created ${0} authenticators`);
  }

  // Create Neo4j user profiles
  console.log("ðŸŒ± Creating Neo4j user profiles...");
  console.log("ðŸŽ‰ PostgreSQL seeding completed!");
}

main()
  .catch((e) => {
    console.error("âŒ PostgreSQL seeding failed:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
    await driver.close();
    console.log("âœ… Database connections closed");
  });
